	#
	# Generate package list from media
	#

	# Create admin file for non-interactive pkgadd's
	ADMIN_FILE=$TMPDIR/admin
	cat << \ADMIN_EOF > $ADMIN_FILE
mail=
instance=unique
partial=nocheck
runlevel=nocheck
idepend=nocheck
rdepend=nocheck
space=nocheck
setuid=nocheck
conflict=nocheck
action=nocheck
networktimeout=60
networkretries=3
authentication=quit
keystore=/var/sadm/security
proxy=
basedir=default
ADMIN_EOF

	echo "Generating ordered package list from $PKGREPOS and installing to $BOOTCD_PROTO"

	/usr/bin/perl $LIVEKIT/proc_toc.pl $METACLUSTER $SOLPRODUCT $LIVEKIT/faketoc | /usr/ccs/bin/tsort | grep -v "INFORM: cycle" | grep -v "SUNWdummy" > $TMPDIR/ordered
	perl $LIVEKIT/rev_file.pl $TMPDIR/ordered | while read pkg
	do
		if [ -d $PKGREPOS/$pkg ]; then
			pkgadd -n -a $ADMIN_FILE -d $PKGREPOS -R $BOOTCD_PROTO $pkg
		else
			pkgi="${pkg}.i"
			if [ -d $PKGREPOS/$pkgi ]
			then
				pkgadd -n -a $ADMIN_FILE -d $PKGREPOS -R $BOOTCD_PROTO $pkgi
			fi
		fi
		if [[ $? -ne 0 ]]
		then
			echo "******* Install of $pkg failed *******"
		fi
	done
